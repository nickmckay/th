<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Name That Jazzy Christmas Tune</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(180deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5), 0 0 60px rgba(217, 119, 6, 0.3);
            border: 3px solid #d97706;
        }

        h1 {
            text-align: center;
            color: #fbbf24;
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.8), 0 0 20px rgba(251, 191, 36, 0.5);
            font-weight: 700;
            letter-spacing: 3px;
            font-style: italic;
        }

        .instructions {
            background: linear-gradient(135deg, #4c1d95 0%, #5b21b6 100%);
            color: #fef3c7;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 18px;
            border: 2px solid #a855f7;
            font-weight: normal;
        }

        .progress-info {
            background: linear-gradient(135deg, #4c1d95 0%, #5b21b6 100%);
            color: #fbbf24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 16px;
            border: 2px solid #a855f7;
            font-weight: bold;
        }

        .progress-info .time-unlock {
            color: #fbbf24;
            font-size: 20px;
        }

        .timer-display {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            color: #fbbf24;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px solid #d97706;
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .timer-item {
            flex: 1;
            min-width: 200px;
        }

        .timer-label {
            font-size: 14px;
            color: #fef3c7;
            margin-bottom: 5px;
        }

        .timer-value {
            font-size: 32px;
            font-weight: bold;
            color: #fbbf24;
            font-family: 'Courier New', monospace;
        }

        .countdown-value {
            color: #10b981;
        }

        .countdown-value.playing {
            color: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .song-item {
            background: linear-gradient(135deg, #2d2665 0%, #1e1b4b 100%);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #6366f1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .song-item.correct {
            border-color: #10b981;
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .song-item.incorrect {
            border-color: #ef4444;
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }

        .song-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .song-number {
            font-size: 18px;
            font-weight: bold;
            color: #1e1b4b;
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            padding: 5px 15px;
            border-radius: 20px;
            border: 2px solid #fcd34d;
        }

        .status-badge {
            font-size: 14px;
            font-weight: bold;
            padding: 5px 12px;
            border-radius: 15px;
            border: 2px solid;
        }

        .status-badge.correct {
            background: #047857;
            color: #d1fae5;
            border-color: #10b981;
        }

        .status-badge.incorrect {
            background: #b91c1c;
            color: #fecaca;
            border-color: #ef4444;
        }

        audio {
            width: 100%;
            height: 32px;
            margin-bottom: 10px;
        }

        .input-container {
            position: relative;
        }

        select, input[type="text"] {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            border: 2px solid #6b7280;
            background: white;
            color: #1f2937;
            font-weight: bold;
        }

        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #fef08a;
            box-shadow: 0 0 10px rgba(254, 240, 138, 0.3);
        }

        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #6b7280;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .autocomplete-list.show {
            display: block;
        }

        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            color: #1f2937;
            border-bottom: 1px solid #e5e7eb;
        }

        .autocomplete-item:hover {
            background: #fef08a;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }


        .success-message {
            background: linear-gradient(135deg, #4c1d95 0%, #5b21b6 100%);
            color: #fbbf24;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            display: none;
            border: 3px solid #a855f7;
            box-shadow: 0 6px 20px rgba(91, 33, 182, 0.5);
        }

        .success-message.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        .success-message h2 {
            font-size: 36px;
            margin-bottom: 15px;
            color: #fbbf24;
            font-style: italic;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .score-display {
            text-align: center;
            font-size: 28px;
            color: #c084fc;
            margin: 20px 0;
            font-weight: bold;
        }

        .score-display .correct {
            color: #fbbf24;
            font-size: 36px;
        }

        .score-display .total {
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∑ Name That Jazzy Christmas Tune üéµ</h1>

        <div class="instructions">
            Guess all the songs! Each song you get correctly gives you an extra 0.5 seconds of listening time. Plus, you earn bonus time for every 5 minutes of play!
        </div>

        <div class="timer-display">
            <div class="timer-item">
                <div class="timer-label">‚è±Ô∏è Total Play Time</div>
                <div class="timer-value" id="playTime">00:00</div>
            </div>
            <div class="timer-item">
                <div class="timer-label">‚è≥ Countdown Timer</div>
                <div class="timer-value countdown-value" id="countdown">--:--</div>
            </div>
        </div>

        <div class="progress-info">
            <div class="time-unlock" id="timeUnlock">üéµ Current Audio Length: 1 second</div>
        </div>

        <div class="score-display" id="scoreDisplay">
            Score: <span class="correct">0</span> / <span class="total">12</span> correct
        </div>


        <div id="songsContainer">
            <!-- Songs will be generated by JavaScript -->
        </div>

        <div class="success-message" id="successMessage">
            <h2>üéâ PERFECT SCORE! üéâ</h2>
            <p style="font-size: 20px;">You correctly identified all 12 Christmas songs!</p>
            <p style="margin-top: 20px; font-size: 18px;">Your next clue is: <strong>Christmas Wreath</strong></p>
        </div>
    </div>

    <script>
        // Correct answers (song number -> song title)
        const correctAnswers = {
            1: "We Three Kings",
            2: "Joy to the World",
            3: "O Christmas Tree",
            4: "Silent Night",
            5: "Carol of the Bells",
            6: "Jingle Bells",
            7: "Hark! The Herald Angels Sing",
            8: "Blue Christmas",
            9: "Let It Snow! Let It Snow! Let It Snow!",
            10: "Deck the Halls",
            11: "We Wish You a Merry Christmas",
            12: "O Come, O Come, Emmanuel"
        };

        // Large list of ~100 Christmas song choices
        const allSongs = [
            "A Christmas Carol",
            "A Holly Jolly Christmas",
            "All I Want for Christmas Is You",
            "Angels We Have Heard on High",
            "Away in a Manger",
            "Baby, It's Cold Outside",
            "Blue Christmas",
            "Carol of the Bells",
            "The Chipmunk Song",
            "Christmas in Hollis",
            "The Christmas Song (Chestnuts Roasting)",
            "Christmas Time Is Here",
            "Christmas Wrapping",
            "Deck the Halls",
            "Do They Know It's Christmas?",
            "Do You Hear What I Hear?",
            "Fairytale of New York",
            "Feliz Navidad",
            "The First Noel",
            "Frosty the Snowman",
            "Go Tell It on the Mountain",
            "God Rest Ye Merry Gentlemen",
            "Good King Wenceslas",
            "Grandma Got Run Over by a Reindeer",
            "Hark! The Herald Angels Sing",
            "Happy Xmas (War Is Over)",
            "Have Yourself a Merry Little Christmas",
            "Here Comes Santa Claus",
            "The Holly and the Ivy",
            "A Holly Jolly Christmas",
            "I Heard the Bells on Christmas Day",
            "I Saw Mommy Kissing Santa Claus",
            "I Saw Three Ships",
            "I'll Be Home for Christmas",
            "It Came Upon a Midnight Clear",
            "It's Beginning to Look a Lot Like Christmas",
            "It's the Most Wonderful Time of the Year",
            "Jingle Bell Rock",
            "Jingle Bells",
            "Joy to the World",
            "Last Christmas",
            "Let It Snow! Let It Snow! Let It Snow!",
            "Little Drummer Boy",
            "Little Saint Nick",
            "March of the Toys",
            "Mary, Did You Know?",
            "Mele Kalikimaka",
            "The Most Wonderful Time of the Year",
            "Mistletoe and Wine",
            "The Night Before Christmas",
            "Nuttin' for Christmas",
            "O Come, All Ye Faithful",
            "O Come, O Come, Emmanuel",
            "O Holy Night",
            "O Little Town of Bethlehem",
            "O Tannenbaum",
            "Rockin' Around the Christmas Tree",
            "Rudolph the Red-Nosed Reindeer",
            "Santa Baby",
            "Santa Claus Is Coming to Town",
            "Silent Night",
            "Silver and Gold",
            "Silver Bells",
            "Sleigh Ride",
            "The Twelve Days of Christmas",
            "Up on the Housetop",
            "We Three Kings",
            "We Wish You a Merry Christmas",
            "What Child Is This?",
            "White Christmas",
            "Winter Wonderland",
            "Wonderful Christmastime",
            "You're a Mean One, Mr. Grinch",
            "Angels from the Realms of Glory",
            "Bring a Torch, Jeanette, Isabella",
            "Ding Dong Merrily on High",
            "Emmanuel",
            "Good Christian Men, Rejoice",
            "Greensleeves",
            "I Wonder as I Wander",
            "In the Bleak Midwinter",
            "Infant Holy, Infant Lowly",
            "Jesus, Jesus, Rest Your Head",
            "Lo, How a Rose E'er Blooming",
            "Mary's Boy Child",
            "O Christmas Tree",
            "Once in Royal David's City",
            "Pat-a-Pan",
            "Rise Up, Shepherd, and Follow",
            "Sing We Now of Christmas",
            "Still, Still, Still",
            "The Coventry Carol",
            "The Friendly Beasts",
            "The Little Road to Bethlehem",
            "The Snow Lay on the Ground",
            "There's a Song in the Air",
            "'Twas the Night Before Christmas",
            "Ukrainian Bell Carol",
            "Unto Us a Boy Is Born",
            "What Are You Doing New Year's Eve?",
            "While Shepherds Watched Their Flocks"
        ].sort();

        let userAnswers = {};
        let audioPlayers = {};
        let correctCount = 0;
        let maxPlayTime = 1; // Starts at 1 second
        let sessionStartTime = Date.now();
        let currentPlayingAudio = null;
        let countdownInterval = null;
        let songOrder = []; // Randomized order of songs

        // Shuffle array using Fisher-Yates algorithm
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Initialize the game
        function init() {
            // Create randomized song order
            songOrder = shuffleArray([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]);
            createSongItems();
            updateScore();
            updateTimeDisplay();
            startPlayTimeTracker();
        }

        // Start the play time tracker
        function startPlayTimeTracker() {
            // Update play time every second
            setInterval(() => {
                const elapsed = Date.now() - sessionStartTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);

                const playTimeDisplay = document.getElementById('playTime');
                playTimeDisplay.textContent =
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                // Recalculate time bonus (might have crossed a 5-minute threshold)
                const previousMaxTime = maxPlayTime;
                checkAnswersRealtime();

                // If max time changed due to time bonus, notify the user
                if (maxPlayTime !== previousMaxTime) {
                    updateTimeDisplay();
                }
            }, 1000);
        }

        // Calculate time bonus: 0.5 seconds per 5 minutes of play
        function getTimeBonus() {
            const elapsed = Date.now() - sessionStartTime;
            const minutes = elapsed / 60000;
            const fiveMinutePeriods = Math.floor(minutes / 5);
            return fiveMinutePeriods * 0.5;
        }

        // Update countdown timer during audio playback
        function updateCountdown(audio) {
            const countdownDisplay = document.getElementById('countdown');

            if (audio && !audio.paused) {
                const remaining = maxPlayTime - audio.currentTime;
                const minutes = Math.floor(remaining / 60);
                const seconds = Math.floor(remaining % 60);
                const milliseconds = Math.floor((remaining % 1) * 10);

                countdownDisplay.textContent =
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${milliseconds}`;
                countdownDisplay.classList.add('playing');
            } else {
                countdownDisplay.textContent = '--:--';
                countdownDisplay.classList.remove('playing');
            }
        }

        // Create all song items
        function createSongItems() {
            const container = document.getElementById('songsContainer');
            container.innerHTML = '';

            for (let displayPos = 0; displayPos < 12; displayPos++) {
                const songNum = songOrder[displayPos]; // Actual song number (1-12)
                const displayNum = displayPos + 1; // Display position (1-12)

                const songDiv = document.createElement('div');
                songDiv.className = 'song-item';
                songDiv.id = `song-${songNum}`;

                songDiv.innerHTML = `
                    <div class="song-header">
                        <span class="song-number">Song #${displayNum}</span>
                        <span class="status-badge" id="status-${songNum}" style="display: none;"></span>
                    </div>
                    <audio id="audio-${songNum}" controls controlsList="nodownload" oncontextmenu="return false;">
                        <source src="songs/song${songNum}.mp3" type="audio/mpeg">
                        Your browser does not support audio.
                    </audio>
                    <div class="input-container">
                        <input type="text"
                               id="input-${songNum}"
                               placeholder="Type to search for song title..."
                               autocomplete="off"
                               oninput="filterSongs(${songNum})"
                               onfocus="showAutocomplete(${songNum})"
                               onblur="setTimeout(() => hideAutocomplete(${songNum}), 200)">
                        <div class="autocomplete-list" id="autocomplete-${songNum}"></div>
                    </div>
                `;

                container.appendChild(songDiv);

                // Setup audio player with time limit
                const audio = document.getElementById(`audio-${songNum}`);
                audioPlayers[songNum] = audio;

                audio.addEventListener('play', () => {
                    // Pause other audio players
                    for (let j = 1; j <= 12; j++) {
                        if (j !== songNum && audioPlayers[j]) {
                            audioPlayers[j].pause();
                        }
                    }
                    currentPlayingAudio = audio;

                    // Start countdown update interval
                    if (countdownInterval) clearInterval(countdownInterval);
                    countdownInterval = setInterval(() => {
                        updateCountdown(currentPlayingAudio);
                    }, 100);
                });

                audio.addEventListener('pause', () => {
                    if (currentPlayingAudio === audio) {
                        currentPlayingAudio = null;
                        updateCountdown(null);
                        if (countdownInterval) {
                            clearInterval(countdownInterval);
                            countdownInterval = null;
                        }
                    }
                });

                audio.addEventListener('timeupdate', () => {
                    if (audio.currentTime >= maxPlayTime) {
                        audio.pause();
                        audio.currentTime = 0;
                    }
                });

                audio.addEventListener('ended', () => {
                    audio.currentTime = 0;
                    currentPlayingAudio = null;
                    updateCountdown(null);
                    if (countdownInterval) {
                        clearInterval(countdownInterval);
                        countdownInterval = null;
                    }
                });
            }
        }

        // Filter songs based on input
        function filterSongs(songNum) {
            const input = document.getElementById(`input-${songNum}`);
            const searchTerm = input.value.toLowerCase();
            const autocomplete = document.getElementById(`autocomplete-${songNum}`);

            if (searchTerm.length === 0) {
                autocomplete.innerHTML = '';
                autocomplete.classList.remove('show');
                return;
            }

            const matches = allSongs.filter(song =>
                song.toLowerCase().includes(searchTerm)
            );

            if (matches.length === 0) {
                autocomplete.innerHTML = '<div class="autocomplete-item">No matches found</div>';
            } else {
                autocomplete.innerHTML = matches.slice(0, 10).map(song =>
                    `<div class="autocomplete-item" onclick="selectSong(${songNum}, '${song.replace(/'/g, "\\'")}')">${song}</div>`
                ).join('');
            }

            autocomplete.classList.add('show');

            // Update user answer
            userAnswers[songNum] = input.value;
            checkAnswersRealtime();
        }

        // Select a song from autocomplete
        function selectSong(songNum, title) {
            const input = document.getElementById(`input-${songNum}`);
            input.value = title;
            userAnswers[songNum] = title;
            hideAutocomplete(songNum);
            checkAnswersRealtime();
        }

        // Show autocomplete
        function showAutocomplete(songNum) {
            const input = document.getElementById(`input-${songNum}`);
            if (input.value.length > 0) {
                filterSongs(songNum);
            }
        }

        // Hide autocomplete
        function hideAutocomplete(songNum) {
            const autocomplete = document.getElementById(`autocomplete-${songNum}`);
            autocomplete.classList.remove('show');
        }

        // Check answers in real-time to update audio duration
        function checkAnswersRealtime() {
            let correct = 0;

            for (let i = 1; i <= 12; i++) {
                const songDiv = document.getElementById(`song-${i}`);
                const status = document.getElementById(`status-${i}`);
                const userAnswer = userAnswers[i];
                const correctAnswer = correctAnswers[i];

                if (userAnswer === correctAnswer) {
                    correct++;
                    songDiv.classList.add('correct');
                    songDiv.classList.remove('incorrect');
                    status.textContent = '‚úì Correct';
                    status.className = 'status-badge correct';
                    status.style.display = 'inline-block';
                } else if (userAnswer) {
                    songDiv.classList.add('incorrect');
                    songDiv.classList.remove('correct');
                    status.textContent = '‚úó Wrong';
                    status.className = 'status-badge incorrect';
                    status.style.display = 'inline-block';
                } else {
                    songDiv.classList.remove('correct', 'incorrect');
                    status.style.display = 'none';
                }
            }

            correctCount = correct;

            // Calculate time bonus from play time
            const timeBonus = getTimeBonus();

            // Calculate max play time: base (1s) + correct answers (0.5s each) + time bonus (0.5s per 5 min)
            // Special case: 11 correct = 45 seconds
            if (correctCount === 11) {
                maxPlayTime = 45 + timeBonus;
            } else {
                maxPlayTime = 1 + (correctCount * 0.5) + timeBonus;
            }

            updateScore();
            updateTimeDisplay();

            // Check if all correct
            if (correctCount === 12) {
                document.getElementById('successMessage').classList.add('show');
            }
        }

        // Update score display
        function updateScore() {
            const scoreDiv = document.getElementById('scoreDisplay');
            scoreDiv.innerHTML = `Score: <span class="correct">${correctCount}</span> / <span class="total">12</span> correct`;
        }

        // Update time unlock display
        function updateTimeDisplay() {
            const timeDiv = document.getElementById('timeUnlock');
            const timeBonus = getTimeBonus();
            const correctBonus = correctCount * 0.5;

            let displayText = `üéµ Current Audio Length: ${maxPlayTime.toFixed(1)} seconds`;

            if (timeBonus > 0 || correctBonus > 0) {
                displayText += ` (Base: 1s`;
                if (correctBonus > 0) {
                    displayText += `, Correct: +${correctBonus.toFixed(1)}s`;
                }
                if (timeBonus > 0) {
                    displayText += `, Time Bonus: +${timeBonus.toFixed(1)}s`;
                }
                displayText += `)`;
            }

            timeDiv.textContent = displayText;
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
